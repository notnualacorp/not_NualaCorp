<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>NualaCorp Terminal</title>
<style>
body { background: #000; color: #00ff99; font-family: monospace; font-size: 16px; margin: 0; padding: 20px; }
#terminal { max-width: 800px; margin: 0 auto; line-height: 1.5; white-space: pre-wrap; }
.input-line { display: flex; align-items: center; margin-top: 10px; }
.prompt { color: #00ffaa; margin-right: 8px; }
input { flex: 1; background: none; border: none; color: #00ff99; font-family: inherit; font-size: inherit; outline: none; }
.response { margin-left: 1em; color: #66ffcc; }
</style>
</head>
<body>
<div id="terminal">
NUALACORP SYSTEM v1.7 — Classified Access<br>
Unauthorized personnel will be monitored.<br><br>
Type anything to begin.<br><br>
</div>

<div class="input-line">
  <span class="prompt">&gt;</span>
  <input type="text" id="commandInput" autocomplete="off" autofocus>
</div>

<script>
const terminal = document.getElementById("terminal");
const input = document.getElementById("commandInput");

const riddles = [
  { question: "A farmer's key to success, what am I?", answer: "xiv felines" },
  { question: "The peaks of the heavens, the abyss of the alphabet. Order prevails, no chaos remains.", answer: "zenith" },
  { question: "A textureless badge of honor select hamsters proudly wear.", answer: "..." }
];

let currentRiddle = 0;
let riddleShown = false;
let overridePrompt = false;

// Add a line to terminal
function addLine(text){
  terminal.innerHTML += text + "<br>";
  terminal.scrollTop = terminal.scrollHeight;
}

// Show next riddle or override prompt
function showNextRiddle(){
  if(currentRiddle < riddles.length){
    addLine("<span class='response'>" + riddles[currentRiddle].question + "</span>");
    riddleShown = true;
  } else {
    addLine("<br>All prompts answered.<br>Enter Terminal Override Code to override Terminal:<br>");
    overridePrompt = true;
  }
}

// Redeem token by calling Google Apps Script
async function redeemToken(token, playerID){
  const url = "https://script.google.com/macros/s/AKfycbzxmEbNkK1IAnSn_vjYOA0JM-HozTkzzdGAE_aLveJ4_-XtwLDAhShgYdGE2SVXbO9b/exec"
            + "?token=" + encodeURIComponent(token)
            + "&playerID=" + encodeURIComponent(playerID)
            + "&redeem=true";

  try {
    const res = await fetch(url, { mode: "cors" });
    if (!res.ok) throw new Error("HTTP " + res.status);
    const text = await res.text();
    let data = JSON.parse(text);

    if (data.success) {
      addLine("<span class='response' style='color:#ffdd00'>Terminal override attempted.</span>");
    } else {
      addLine("<span class='response' style='color:#ff4444'>❌ Override failed: " + (data.error || "invalid token") + ".</span>");
    }
  } catch (err) {
    console.warn("Redeem error:", err);
    addLine("<span class='response' style='color:#ff4444'>❌ Connection failed or blocked by CORS. Token not verified.</span>");
  }
}





// Handle Enter key
input.addEventListener("keydown", function(e){
  if(e.key === "Enter"){
    const cmd = input.value.trim();
    input.value = "";
    addLine("> " + cmd);

    if(!overridePrompt){
      if(!riddleShown){
        showNextRiddle();
        return;
      }

      if(cmd.toLowerCase() === riddles[currentRiddle].answer.toLowerCase()){
        riddleShown = false;
        currentRiddle++;
        showNextRiddle();
      } else {
        addLine("<span class='response'>Incorrect. Try again.</span>");
      }
      return;
    }

    if(overridePrompt){
      const token = cmd;
      const playerID = prompt("Please enter user identification number.");
      if(playerID){
        redeemToken(token, playerID);
      } else {
        addLine("<span class='response'>You must enter your UserID.</span>");
      }
    }
  }
});
</script>
</body>
</html>
